<div *ngIf="recipe">

  <h2>{{ recipe.name | uppercase }}</h2>

  <h4> The Deets</h4>
  <form #recipeForm="ngForm">
    <div><span>ID: </span>{{recipe.id}}</div>
    <div>
      <label>Name:</label>
      <span (click)="editField('name')" *ngIf="!isFieldInEditMode('name')">{{recipe.name}}</span>
      <input id = "name"
             [(ngModel)]="recipe.name" type = "text"
             #name="ngModel"
             placeholder="name"
             [hidden]="!isFieldInEditMode('name')"
             (keyup.enter)="unfocusField('name')"
             (focusout)="unfocusField('name')"
             (focusin)="editField('name')"
             name="name"
             required
      />
      <div *ngIf="isFieldInEditMode('name')">
        <div *ngIf="(name.invalid && (name.dirty || name.touched))"
             class="alert alert-danger">

          <div *ngIf="name.errors.required">
            Name is required.
          </div>
        </div>
      </div>
    </div>
    <div>
      <label>Category:</label>
      <span (click)="editField('category')" *ngIf="!isFieldInEditMode('category')">{{recipe.category}}</span>
      <input id="category"
             [(ngModel)]="recipe.category" type = "text"
             placeholder="category"
             (keyup.enter)="unfocusField('category')"
             (focusout)="unfocusField('category')"
             (focusin)="editField('category')"
             [hidden]="!isFieldInEditMode('category')"
             name="category"

      />
    </div>
    <div class="list-group">
      <label>Ingredients:</label>
      <ul>
        <li *ngFor="let ingredient of recipe.ingredients;let index = index; trackBy:trackByIndex">
          <span (click)="editField('ingredients', index)" *ngIf="!isFieldInEditMode('ingredients', index)">{{recipe.ingredients[index]}}</span>
          <input id="ingredients{{index}}"
            [(ngModel)]="recipe.ingredients[index]"
                 *ngIf="isFieldInEditMode('ingredients', index)"
                 (keyup.enter)="unfocusField('ingredients')"
                 (focusout)="unfocusField('ingredients')"
                 name="ingredients{{index}}"
                 required
          />
          <button (click)="deleteIngredient(index)">Delete ingredient</button>
        </li>
        <button (click)="addIngredient()">Add ingredient</button>
      </ul>
    </div>
    <div>
      <label>Number of Servings:
        <span (click)="editField('numberOfServings')" *ngIf="!isFieldInEditMode('numberOfServings')">{{recipe.numberOfServings}}</span>
        <input id="numberOfServings"
          [(ngModel)]="recipe.numberOfServings"
               placeholder="number of servings"
               *ngIf="isFieldInEditMode('numberOfServings')"
               (keyup.enter)="unfocusField('numberOfServings')"
               (focusout)="unfocusField('numberOfServings')"
               (focusin)="editField('numberOfServings')"
               name="numberOfServings"
        />
      </label>
    </div>
    <div class="list-group">
      <label>Instructions: </label>
      <ol>
        <li *ngFor="let instruction of recipe.instructions; let index = index; trackBy:trackByIndex">
          <span (click)="editField('instructions', index)" *ngIf="!isFieldInEditMode('instructions', index)">{{recipe.instructions[index]}}</span>
          <input id="instructions{{index}}"
            [(ngModel)]="recipe.instructions[index]"
                 *ngIf="isFieldInEditMode('instructions', index)"
                 (keyup.enter)="unfocusField('instructions')"
                 (focusout)="unfocusField('instructions')"
                 name="instructions{{index}}"
                 required
          />
          <button (click)="deleteInstruction(index)">Delete step</button>
        </li>
        <button (click)="addInstruction()">Add step</button>
      </ol>
    </div>
    <div>
      <label>Date Created:
        <span>{{recipe.dateCreated | date:"MM/dd/yy" }}</span>
      </label>
    </div>
    <div>
      <label>Date Modified:
        <span>{{recipe.dateModified | date:"MM/dd/yy" }}</span>
      </label>
    </div>
    <div>
      <label>Notes:</label>
      <span (click)="editField('notes')" *ngIf="!isFieldInEditMode('notes')">{{recipe.notes}}</span>
      <div>
    <textarea [(ngModel)]="recipe.notes"
              placeholder="miscellaneous notes"
              *ngIf="isFieldInEditMode('notes')"
              (keyup.enter)="unfocusField('notes')"
              (focusout)="unfocusField('notes')"
              (focusin)="editField('notes')"
              name="notes"
    ></textarea>
      </div>
    </div>
    <div>
      <span class="error-message">
        {{formError}}
      </span>
    </div>
    <div *ngIf="recipeForm.dirty && !newRecipeMode">
      <button (click)="updateRecipe()">Update Recipe</button>
    </div>
    <div *ngIf="newRecipeMode">
      <button (click)="saveNewRecipe()">Save new recipe</button>
    </div>
  </form>

</div>
